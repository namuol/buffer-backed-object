(function(l,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(l=typeof globalThis<"u"?globalThis:l||self,s(l["buffer-backed-object"]={}))})(this,function(l){"use strict";function s(t){return typeof t=="symbol"?!1:!isNaN(t)}function a(t,e){let n=t-t%e;return t%e!=0&&(n+=e),n}function O(t){let e=0;for(const{align:n=1,size:i}of Object.values(t))e=a(e,n)+i;return e=a(e,d(t)),e}function d(t){return Math.max(...Object.values(t).map(e=>e.align??1))}function y(t,e,{byteOffset:n=0,length:i=0,align:r=d(e)}={}){const f=new DataView(t,n);let g=0;const B={...e};for(const[u,o]of Object.entries(B))B[u]={...o,offset:a(g,o.align??1)},g=B[u].offset+o.size;return g=a(g,r),i||(i=Math.floor((t.byteLength-n)/g)),new Proxy(new Array(i),{has(u,o){return s(o)?o<i:o==="buffer"?!0:o in u},get(u,o,L){if(o==="buffer")return t;if(!s(o)){let E=u[o];return typeof E=="function"&&(E=E.bind(L)),E}const c=parseInt(o),U=c*g;if(!(c>=u.length)){if(!u[c]){u[c]={};for(const[E,b]of Object.entries(B))"get"in b&&Object.defineProperty(u[c],E,{enumerable:!0,get(){return b.get(f,U+b.offset)},set(R){return b.set(f,U+b.offset,R)}});Object.freeze(u[c])}return u[c]}}})}function I(t,e,{byteOffset:n=0,align:i=1}={}){return y(t,e,{byteOffset:n,align:i})[0]}function T({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Uint16",align:e,size:Uint16Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getUint16(r,n),set:(i,r,f)=>i.setUint16(r,f,n)}}function h({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Uint32",align:e,size:Uint32Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getUint32(r,n),set:(i,r,f)=>i.setUint32(r,f,n)}}function j({endianness:t="little",align:e=2}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Int16",align:e,size:Int16Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getInt16(r,n),set:(i,r,f)=>i.setInt16(r,f,n)}}function A({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Int32",align:e,size:Int32Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getInt32(r,n),set:(i,r,f)=>i.setInt32(r,f,n)}}function w({endianness:t="little",align:e=4}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Float32",align:e,size:Float32Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getFloat32(r,n),set:(i,r,f)=>i.setFloat32(r,f,n)}}function z({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"Float64",align:e,size:Float64Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getFloat64(r,n),set:(i,r,f)=>i.setFloat64(r,f,n)}}function _({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"BigInt64",align:e,size:BigInt64Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getBigInt64(r,n),set:(i,r,f)=>i.setBigInt64(r,f,n)}}function F({endianness:t="little",align:e=8}={}){if(t!=="big"&&t!=="little")throw Error("Endianness needs to be either 'big' or 'little'");const n=t==="little";return{type:"BigUint64",align:e,size:BigUint64Array.BYTES_PER_ELEMENT,get:(i,r)=>i.getBigUint64(r,n),set:(i,r,f)=>i.setBigUint64(r,f,n)}}function S(){return{type:"Uint8",align:1,size:1,get:(t,e)=>t.getUint8(e),set:(t,e,n)=>t.setUint8(e,n)}}function k(){return{type:"Int8",align:1,size:1,get:(t,e)=>t.getInt8(e),set:(t,e,n)=>t.setInt8(e,n)}}function M(t){const e=O(t);return{type:"NestedBufferBackedObject",align:d(t),size:e,innerDescriptors:t,get:(n,i)=>y(n.buffer,t,{byteOffset:n.byteOffset+i,length:1})[0],set:(n,i,r)=>{throw Error("Can’t set an entire struct")}}}function N(t,e){const n=O(e)*t;return{type:"NestedArrayOfBufferBackedObjects",align:Object.values(e)[0].align??1,size:n,innerDescriptors:e,get:(i,r)=>y(i.buffer,e,{byteOffset:r+i.byteOffset,length:t}),set:(i,r,f)=>{throw Error("Can’t set an entire array")}}}function P(t){return{type:"UTF8String",align:1,size:t,get:(e,n)=>new TextDecoder().decode(new Uint8Array(e.buffer,n,t)).replace(/\u0000+$/,""),set:(e,n,i)=>{const r=new TextEncoder().encode(i),f=new Uint8Array(e.buffer,n,t);f.fill(0),f.set(r.subarray(0,t))}}}function v(t){return{type:"reserved",align:1,size:t,get(){},set(){}}}l.ArrayOfBufferBackedObjects=y,l.BigInt64=_,l.BigUint64=F,l.BufferBackedObject=I,l.Float32=w,l.Float64=z,l.Int16=j,l.Int32=A,l.Int8=k,l.NestedArrayOfBufferBackedObjects=N,l.NestedBufferBackedObject=M,l.UTF8String=P,l.Uint16=T,l.Uint32=h,l.Uint8=S,l.nextAlign=a,l.reserved=v,l.structAlign=d,l.structSize=O,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
